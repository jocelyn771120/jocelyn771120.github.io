<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>WHCTF Easyhook | Limpidity</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="shortcut icon" href="/favicon.png">
    <link rel="stylesheet" href="/css/style.css">
</head>

<body>
<nav class="navbar">
    <div class="layout">
        <div class="content ">
            
            
            <a href="/.">Home</a>
            
            
            
            <a href="/archives">Archive</a>
            
            
        </div>
    </div>
</nav>

<main class="post">
    <article>
    <h1 class="article-title">
        <a href="/2017/09/24/whctf-re-easyhook/">WHCTF Easyhook</a>
    </h1>

    <section class="article-meta">
        <p class="article-date">September 24 2017</p>
    </section>

    <section class="article-entry">
        <p>做到一半没做出来的题目，看了下writeup，发现掉进坑里了，重做了一遍。    </p>
<p>输入长度为19，开始随便输入19位字符串进行调试,本来以为是在sub_401240处但是调试的时候发现到此函数的时候输入的字符串已经经过加密了，就往上找断点。<br><img src="http://osuzegp2h.bkt.clouddn.com/8.1.png" alt="images">    </p>
<p>发现经过WriteFile函数之后字符串已经经过加密了，跟进去进入00401000，再跟进去就是加密算法了。<br><img src="http://osuzegp2h.bkt.clouddn.com/8.2.png" alt="images"><br>当时调试了下以为只要经过这个加密然后把加密后的字符串和sub_401240处”this_is_not_the_flag”进行比较就能得到flag，但是当时也很奇怪为啥sub_401240处的字符串是20位的，于是就去掉最后一个g去写脚本发现跑出来根本不是，就一直卡在这里，今天看了wp之后发现其实这个加密算法后面还有一个函数，当时根本没注意。<br><img src="http://osuzegp2h.bkt.clouddn.com/8.3.png" alt="images"><br>这个循环是用来检测加密之后的字符串和0040A030处的字符串是否一样，所以说其实真正要进行对比的是0040A030处的字符串而不是”this_is_not_the_fla”。所以脚本如下：    </p>
<pre><code class="flag.py">s=&quot;ajygkFm.\x7f_~-SV{8mLn&quot;    
flag=[&apos;&apos;for i in range(19)]    
for i in range(18,-1,-1):
    if i%2 !=0:
        flag[i] = chr((ord(s[i]) ^ i) + i)
    else:
        if(i&gt;1):
            flag[i] = chr(ord(s[i-2]) ^ (i-2))

flag[18] = chr(ord(s[18]) ^ 0x13)
print &apos;&apos;.join(flag)
</code></pre>
<p>但是还要注意的是，第一个算法是从第二位开始的，第一位就是下面0040A030数据段中的第一个字母也就是a，所以合起来得到flag。</p>

    </section>
</article>

</main>
<footer class="footer">
    <p>Powered by Moren YANG&nbsp;&nbsp;-&nbsp;&nbsp;ackn. <a href="https://hexo.io"> Hexo </a></p>
</footer>

</body>
</html>
